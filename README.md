# 作物性状预测系统

基于深度学习的作物性状预测系统，结合基因型数据和环境数据实现高精度作物性状表现预测。

## 目录

- [项目概述](#项目概述)
- [模型架构](#模型架构)
- [数据处理](#数据处理)
- [实验设计](#实验设计)
- [使用指南](#使用指南)
- [系统要求](#系统要求)

## 项目概述

本项目旨在通过深度学习技术预测不同基因型在各种环境条件下的作物性状表现。通过有效捕捉基因型与环境之间的复杂交互关系，实现对作物表现的精确预测，为作物育种和农业决策提供数据支持。

### 主要特点

- 结合基因型和环境数据的多模型集成架构
- 专门设计的交叉注意力机制，有效捕捉G×E交互关系
- 基于多种实验设计的全面评估系统
- 针对不同预测场景的优化策略

## 模型架构

项目中实现了多种深度学习模型架构：

### 1. DeepGxE

基础深度学习模型，使用多层感知机分别提取基因型和环境特征，然后融合预测表型。

```
基因型数据 → 多层感知机 → 特征融合层 → 表型预测
环境数据 → 多层感知机 ↗
```

### 2. AttentionGxE

标准注意力模型，使用4个注意力头捕捉基因型和环境特征之间的交互关系。

```
基因型数据 → 编码器 → 多头注意力机制 → 特征融合 → 表型预测
环境数据 → 编码器 ↗
```

### 3. CrossAttentionGxE

交叉注意力模型，使用8个注意力头和双线性交互层增强基因型-环境交互建模。

```
基因型数据 → 深层编码器 → 自注意力机制 → 交互层 → 表型预测
环境数据 → 深层编码器 → 双线性交互层 ↗
```

## 数据处理

### 数据结构

项目处理三类数据：

1. **基因型数据** (genodata.txt)：
   - 每行代表一个样本，列为基因型标记
   - 值为-1、0或1的矩阵

2. **环境数据** (environment/*.xlsx)：
   - 不同地点和年份的环境指标
   - 包含多种气象和土壤参数的时间序列数据

3. **表型数据** (characteristic/*.txt)：
   - 每个基因型在特定环境下的性状表现
   - 文件名格式为"地点_年份.txt"

### 数据处理流程

```
数据加载 → 数据标准化 → 特征扩展 → 交叉验证划分
```

- **标准化**：使用鲁棒标准化方法处理异常值
- **特征扩展**：增强环境特征，添加统计和非线性特征
- **分层交叉验证**：根据实验设计创建适合的交叉验证方案

## 实验设计

项目设计了三种互补的实验方案，全面评估模型的泛化能力：

### 实验1：基因型泛化能力测试

- **目标**：评估模型对新基因型的预测能力
- **数据划分**：全部12个环境，90%基因型训练，10%基因型测试
- **交叉验证**：10折交叉验证（按基因型划分）
- **脚本**：`main1.py`

### 实验2：环境泛化能力测试

- **目标**：评估模型对新环境的预测能力
- **数据划分**：5个地点（10个环境）训练，1个地点（2个环境）测试
- **交叉验证**：6折交叉验证（按地点划分）
- **脚本**：`main2.py`

### 实验3：综合泛化能力测试

- **目标**：评估模型对新基因型在新环境下的预测能力
- **数据划分**：5个地点（10个环境）和90%基因型训练，1个地点和10%基因型测试
- **交叉验证**：60组组合交叉验证（10折基因型 × 6折地点）
- **脚本**：`main3.py`

## 使用指南

### 项目结构

```
.
├── basedata/                # 训练数据文件夹
│   ├── BPP/                 # 不同性状文件夹
│   │   ├── genodata.txt     # 基因型数据
│   │   ├── environment/     # 环境数据文件夹
│   │   └── characteristic/  # 表型数据文件夹
│   └── ...                  # 其他性状
├── testdata/                # 测试数据文件夹
├── models.py                # 模型定义
├── utils.py                 # 工具函数
├── trainer.py               # 训练器
├── main1.py                 # 实验1主程序
├── main2.py                 # 实验2主程序
├── main3.py                 # 实验3主程序
└── run_experiment.py        # 实验执行脚本
```

### 运行实验

```bash
# 运行实验1 - 基因型泛化
python main1.py

# 运行实验2 - 环境泛化
python main2.py

# 运行实验3 - 综合泛化
python main3.py

# 运行完整实验流程
python run_experiment.py
```

### 结果解读

执行实验后，将生成以下结果：

1. **训练日志**：包含每个epoch的训练和验证损失
2. **评估指标**：ARE（绝对相对误差）、MSE（均方误差）和Pearson相关系数
3. **预测结果**：CSV格式的预测结果文件
4. **可视化图表**：预测结果和模型性能的图形化展示

## 系统要求

### 硬件要求

- CPU：4核以上（推荐）
- RAM：8GB以上（推荐16GB）
- GPU：支持CUDA的GPU（可选，但推荐用于加速训练）

### 软件依赖

- Python 3.8+
- PyTorch 1.8+
- NumPy
- Pandas
- scikit-learn
- Matplotlib（可视化）

### 安装依赖

```bash
pip install torch numpy pandas scikit-learn matplotlib
``` 